
{% extends 'base.html' %}
{% load static %}

{% block content %}

    <main class="main" id="top">
      <nav class="navbar navbar-vertical navbar-expand-lg" style="display:none;">
        <div class="collapse navbar-collapse" id="navbarVerticalCollapse">
          <!-- scrollbar removed-->
          <div class="navbar-vertical-content">
            <ul class="navbar-nav flex-column" id="navbarVerticalNav">
              <li class="nav-item">
                <!-- parent pages-->
                <div class="nav-item-wrapper"><a class="nav-link dropdown-indicator label-1" href="#nv-home" role="button" data-bs-toggle="collapse" aria-expanded="true" aria-controls="nv-home">
                    <div class="d-flex align-items-center">
                      <div class="dropdown-indicator-icon-wrapper"><span class="fas fa-caret-right dropdown-indicator-icon"></span></div><span class="nav-link-icon"><span data-feather="pie-chart"></span></span><span class="nav-link-text">Home</span>
                    </div>
                  </a>
                  <div class="parent-wrapper label-1">
                    <ul class="nav collapse parent show" data-bs-parent="#navbarVerticalCollapse" id="nv-home">
                      <li class="collapsed-nav-item-title d-none">Home</li>
                      <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:fetch-customer-data' %}">
                          <div class="d-flex align-items-center"><span class="nav-link-text">Dashboard</span></div>
                        </a><!-- more inner pages-->
                      </li>
                    </ul>
                  </div>
                </div>
              </li>
              <li class="nav-item">
                <!-- label-->
                <p class="navbar-vertical-label">Apps</p>
                <hr class="navbar-vertical-line" /><!-- parent pages-->
                <div class="nav-item-wrapper"><a class="nav-link dropdown-indicator label-1" href="#nv-e-commerce" role="button" data-bs-toggle="collapse" aria-expanded="false" aria-controls="nv-e-commerce">
                    <div class="d-flex align-items-center">
                      <div class="dropdown-indicator-icon-wrapper"><span class="fas fa-caret-right dropdown-indicator-icon"></span></div><span class="nav-link-icon"><span data-feather="shopping-cart"></span></span><span class="nav-link-text">Zip Fit</span>
                    </div>
                  </a>
                  <div class="parent-wrapper label-1">
                          <ul class="nav collapse parent show" data-bs-parent="#e-commerce" id="nv-admin">
                            <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:add_window_configuration' %}">
                                <div class="d-flex align-items-center"><span class="nav-link-text">Add product</span></div>
                              </a><!-- more inner pages-->
                            </li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:product_list' %}">
                                <div class="d-flex align-items-center"><span class="nav-link-text" >Products</span></div>
                              </a><!-- more inner pages-->
                            </li>
          
                            <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:orders' %}">
                                <div class="d-flex align-items-center"><span class="nav-link-text">Orders</span></div>
                              </a><!-- more inner pages-->
                            </li>

                          </ul>
                  </div>
                </div><!-- parent pages-->
               
               

              </li>
            </ul>
          </div>
        </div>
        <div class="navbar-vertical-footer"><button class="btn navbar-vertical-toggle border-0 fw-semibold w-100 white-space-nowrap d-flex align-items-center"><span class="uil uil-left-arrow-to-left fs-8"></span><span class="uil uil-arrow-from-right fs-8"></span><span class="navbar-vertical-footer-text ms-2">Collapsed View</span></button></div>
      </nav>
      <nav class="navbar navbar-top fixed-top navbar-expand" id="navbarDefault" style="display:none;">
        <div class="collapse navbar-collapse justify-content-between">
          <div class="navbar-logo">
            <button class="btn navbar-toggler navbar-toggler-humburger-icon hover-bg-transparent" type="button" data-bs-toggle="collapse" data-bs-target="#navbarVerticalCollapse" aria-controls="navbarVerticalCollapse" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>
            <a class="navbar-brand me-1 me-sm-3" href="">
              <div class="d-flex align-items-center">
                <div class="d-flex align-items-center"><img src="{% static 'img/favicons/451557879_310712962030846_2095178685349646451_n.jpg' %}" alt="phoenix" width="70" />
                </div>
              </div>
            </a>
          </div>

          <ul class="navbar-nav navbar-nav-icons flex-row">
            <li class="nav-item">
              <div class="theme-control-toggle fa-icon-wait px-2"><input class="form-check-input ms-0 theme-control-toggle-input" type="checkbox" data-theme-control="phoenixTheme" value="dark" id="themeControlToggle" /><label class="mb-0 theme-control-toggle-label theme-control-toggle-light" for="themeControlToggle" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="Switch theme" style="height:32px;width:32px;"><span class="icon" data-feather="moon"></span></label><label class="mb-0 theme-control-toggle-label theme-control-toggle-dark" for="themeControlToggle" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="Switch theme" style="height:32px;width:32px;"><span class="icon" data-feather="sun"></span></label></div>
            </li>


            <li class="nav-item dropdown"><a class="nav-link lh-1 pe-0" id="navbarDropdownUser" href="#!" role="button" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-haspopup="true" aria-expanded="false">
                <div class="avatar avatar-l ">
                  <img class="rounded-circle " src="{% static 'img/favicons/451557879_310712962030846_2095178685349646451_n.jpg' %}" alt="" />
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end navbar-dropdown-caret py-0 dropdown-profile shadow border" aria-labelledby="navbarDropdownUser">
                <div class="card position-relative border-0">
                  <div class="card-body p-0">
                    <div class="text-center pt-4 pb-3">
                      <div class="avatar avatar-xl ">
                        <img class="rounded-circle " src="{% static 'img/favicons/451557879_310712962030846_2095178685349646451_n.jpg' %}" alt="" />
                      </div>
                      <h6 class="mt-2 text-body-emphasis">Jerry Seinfield</h6>
                    </div>
                  </div>
                  <div class="overflow-auto scrollbar" style="height: 2rem;">
                    <ul class="nav d-flex flex-column mb-2 pb-1">
                      <li class="nav-item"><a class="nav-link px-3 d-block" href="#!"> <span class="me-2 text-body align-bottom" data-feather="user"></span><span>Profile</span></a></li>
                    </ul>
                  </div>
                  <div class="card-footer p-0 border-top border-translucent">
                    <div class="px-3"> <a class="btn btn-phoenix-secondary d-flex flex-center w-100" href="#!"> <span class="me-2" data-feather="log-out"> </span>Sign out</a></div>
                    <div class="my-2 text-center fw-bold fs-10 text-body-quaternary"><a class="text-body-quaternary me-1" href="#!">Privacy policy</a>&bull;<a class="text-body-quaternary mx-1" href="#!">Terms</a>&bull;<a class="text-body-quaternary ms-1" href="#!">Cookies</a></div>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </nav>


      <script>
        var navbarTopShape = window.config.config.phoenixNavbarTopShape;
        var navbarPosition = window.config.config.phoenixNavbarPosition;
        var body = document.querySelector('body');
        var navbarDefault = document.querySelector('#navbarDefault');
        var navbarTop = document.querySelector('#navbarTop');
        var topNavSlim = document.querySelector('#topNavSlim');
        var navbarTopSlim = document.querySelector('#navbarTopSlim');
        var navbarCombo = document.querySelector('#navbarCombo');
        var navbarComboSlim = document.querySelector('#navbarComboSlim');
        var dualNav = document.querySelector('#dualNav');

        var documentElement = document.documentElement;
        var navbarVertical = document.querySelector('.navbar-vertical');

        if (navbarPosition === 'dual-nav') {
          topNavSlim?.remove();
          navbarTop?.remove();
          navbarTopSlim?.remove();
          navbarCombo?.remove();
          navbarComboSlim?.remove();
          navbarDefault?.remove();
          navbarVertical?.remove();
          dualNav.removeAttribute('style');
          document.documentElement.setAttribute('data-navigation-type', 'dual');

        } else if (navbarTopShape === 'slim' && navbarPosition === 'vertical') {
          navbarDefault?.remove();
          navbarTop?.remove();
          navbarTopSlim?.remove();
          navbarCombo?.remove();
          navbarComboSlim?.remove();
          topNavSlim.style.display = 'block';
          navbarVertical.style.display = 'inline-block';
          document.documentElement.setAttribute('data-navbar-horizontal-shape', 'slim');

        } else if (navbarTopShape === 'slim' && navbarPosition === 'horizontal') {
          navbarDefault?.remove();
          navbarVertical?.remove();
          navbarTop?.remove();
          topNavSlim?.remove();
          navbarCombo?.remove();
          navbarComboSlim?.remove();
          dualNav?.remove();
          navbarTopSlim.removeAttribute('style');
          document.documentElement.setAttribute('data-navbar-horizontal-shape', 'slim');
        } else if (navbarTopShape === 'slim' && navbarPosition === 'combo') {
          navbarDefault?.remove();
          navbarTop?.remove();
          topNavSlim?.remove();
          navbarCombo?.remove();
          navbarTopSlim?.remove();
          dualNav?.remove();
          navbarComboSlim.removeAttribute('style');
          navbarVertical.removeAttribute('style');
          document.documentElement.setAttribute('data-navbar-horizontal-shape', 'slim');
        } else if (navbarTopShape === 'default' && navbarPosition === 'horizontal') {
          navbarDefault?.remove();
          topNavSlim?.remove();
          navbarVertical?.remove();
          navbarTopSlim?.remove();
          navbarCombo?.remove();
          navbarComboSlim?.remove();
          dualNav?.remove();
          navbarTop.removeAttribute('style');
          document.documentElement.setAttribute('data-navigation-type', 'horizontal');
        } else if (navbarTopShape === 'default' && navbarPosition === 'combo') {
          topNavSlim?.remove();
          navbarTop?.remove();
          navbarTopSlim?.remove();
          navbarDefault?.remove();
          navbarComboSlim?.remove();
          dualNav?.remove();
          navbarCombo.removeAttribute('style');
          navbarVertical.removeAttribute('style');
          document.documentElement.setAttribute('data-navigation-type', 'combo');
        } else {
          topNavSlim?.remove();
          navbarTop?.remove();
          navbarTopSlim?.remove();
          navbarCombo?.remove();
          navbarComboSlim?.remove();
          dualNav?.remove();
          navbarDefault.removeAttribute('style');
          navbarVertical.removeAttribute('style');
        }

        var navbarTopStyle = window.config.config.phoenixNavbarTopStyle;
        var navbarTop = document.querySelector('.navbar-top');
        if (navbarTopStyle === 'darker') {
          navbarTop.setAttribute('data-navbar-appearance', 'darker');
        }

        var navbarVerticalStyle = window.config.config.phoenixNavbarVerticalStyle;
        var navbarVertical = document.querySelector('.navbar-vertical');
        if (navbarVerticalStyle === 'darker') {
          navbarVertical.setAttribute('data-navbar-appearance', 'darker');
        }
      </script>
      <div class="content">
        <nav class="mb-3" aria-label="breadcrumb">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="#!">Home</a></li>
            <li class="breadcrumb-item active">Customer Details</li>
          </ol>
        </nav>
        <div class="mb-9">
          <div class="row align-items-center justify-content-between g-3 mb-4">
            <div class="col-auto">
              <h2 class="mb-0">Customer details</h2>
            </div>
            <div class="col-auto">
              <div class="row g-3">
                <!-- <div class="col-auto"><button class="btn btn-phoenix-danger"><span class="fa-solid fa-trash-can me-2"></span>Delete customer</button></div> -->
              </div>
            </div>
          </div>
          <div class="row g-5">
                    <div class="col-12 col-md-5 col-xxl-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <h3 class="me-1">{{customer.customer_name}}</h3>
                                </div>
                                <h5 class="text-body-secondary">Address</h5>
                                <p class="text-body-secondary">
                                    {{ customer.customer_address|linebreaksbr }}<br>
                                </p>
                                <div class="mb-3">
                                    <h5 class="text-body-secondary">Email</h5>
                                    <a href="mailto:{{ customer.customer_email }}">{{ customer.customer_email }}</a>
                                </div>
                                <h5 class="text-body-secondary">Phone</h5>
                                <a class="text-body-secondary" href="tel:{{ customer.customer_phone }}">
                                    {{ customer.customer_phone }}
                                </a>
                                
                            </div>
                        </div>
                    </div>
            <div class="col-12">
                <div class="row flex g-3 h-100">

                    {% for orders in customer_orders %}

                    <div class="col-12 col-md-7 col-xxl-12">
                        <div class="card h-100 h-xxl-auto">
                            <div class="card-body d-flex flex-column justify-content-between pb-3">
                                <div class="row align-items-center g-5 mb-3 text-center text-sm-start">
                                    <div class="col-12 col-sm-auto mb-sm-2">
                                        <div class="avatar avatar-5xl">
                                            {% if orders.window_model and orders.window_model.image %}
                                                <img class="rounded-circle" src="{{ customer.window_model.image.url }}" alt="Window Configuration Image" />
                                            {% else %}
                                                <img class="rounded-circle" src="/static/assets/img/default-window.png" alt="Default Window Image" />
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-auto flex-1">
                                        {% if orders.window_model %}
                                            <p class="text-body-secondary">
                                                Window Series: {{ orders.window_model.window_series }}
                                            </p>
                                              
                                        <p class="text-body-secondary">Joined {{ orders.created_at|timesince }} ago</p>
                                            <p class="text-body-secondary">
                                                Window Type: {{ orders.window_model.window_type }}
                                            </p>
                                            <p class="text-body-secondary">
                                                Dimensions: {{ orders.window_model.width }} x {{ orders.window_model.height }}
                                            </p>
                                        {% endif %}   
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% endfor %}
                </div>
            </div>
            
            <div class="col-12">
              <div class="mb-6">
                  <h3 class="mb-4">Window Configurations <span class="text-body-tertiary fw-normal">({{ customer_orders.count }})</span></h3>
                  <div class="border-translucent border-top border-bottom" id="customerWindowConfigTable" data-list='{"valueNames":["type","series","dimensions","surface","coating","fitting","puffing","mosquito","price"],"page":5,"pagination":true}'>
                  <div class="table-responsive scrollbar">
                      <table class="table fs-9 mb-0">
                          <thead>
                              <tr>
                                  <th class="sort white-space-nowrap align-middle fs-10" scope="col" style="width:5%;"></th>
                                  <th class="sort white-space-nowrap align-middle" scope="col" style="width:15%;" data-sort="type">WINDOW TYPE</th>
                                  <th class="sort align-middle" scope="col" data-sort="series" style="width:10%;">SERIES</th>
                                  <th class="sort align-middle" scope="col" data-sort="dimensions" style="width:10%;">DIMENSIONS</th>
                                  <th class="sort align-middle" scope="col" data-sort="surface" style="width:15%;">SURFACE</th>
                                  {% if customer.powder_coating_type %}
                                  <th class="sort align-middle" scope="col" data-sort="coating" style="width:10%;">COATING</th>
                                  {% endif %}
                                  <th class="sort align-middle" scope="col" data-sort="fitting" style="width:10%;">FITTING</th>
                                  <th class="sort align-middle" scope="col" data-sort="puffing" style="width:10%;">PUFFING</th>
                                  <th class="sort align-middle" scope="col" data-sort="mosquito" style="width:10%;">MOSQUITO NET</th>
                                  <th class="sort align-middle text-end" scope="col" data-sort="price" style="width:10%;">APPROXIMATE AMOUNT</th>
                                  <th class="sort align-middle text-end" scope="col" style="width:5%;">ACTION</th>
                              </tr>
                          </thead>
                          <tbody class="list" id="customer-window-config-table-body">
                            {% for order in customer_orders%}
                              {% if order.window_model %}
                              <tr class="hover-actions-trigger btn-reveal-trigger position-static">
                                  <td class="align-middle white-space-nowrap py-1">
                                      {% if order.window_model.image %}
                                          <img class="border border-translucent rounded-2" src="{{ order.window_model.image.url }}" alt="Window Image" width="40" height="40" />
                                      {% else %}
                                          <div class="border border-translucent rounded-2 d-flex align-items-center justify-content-center" style="width:40px;height:40px;">
                                              <span class="fas fa-window-maximize text-body-tertiary"></span>
                                          </div>
                                      {% endif %}
                                  </td>
                                  <td class="type align-middle">
                                      <a class="fw-semibold mb-0" href="#!">
                                          {{ order.window_model.window_type|default:"-" }}
                                      </a>
                                  </td>
                                  <td class="series align-middle white-space-nowrap fs-9 text-body">
                                      {{ order.window_model.window_series|default:"-" }}
                                  </td>
                                  <td class="dimensions align-middle white-space-nowrap text-body-tertiary fs-9 fw-semibold">
                                      {% if order.window_model.width and order.window_model.height %}
                                          {{ order.window_model.width }} x {{ order.window_model.height }}
                                      {% else %}
                                          -
                                      {% endif %}
                                  </td>
                                  <td class="surface align-middle white-space-nowrap fs-9 text-body">
                                      {{ order.surface_treatment|default:"-" }}
                                      {% if order.wood_lamination_types.exists %}
                                          <br>({{ order.wood_lamination_types.all|join:", " }})
                                      {% endif %}
                                  </td>
                                  {% if order.powder_coating_type %}
                                  <td class="coating align-middle white-space-nowrap fs-9 text-body">
                                      {{ order.powder_coating_type }}
                                      {% if order.powder_coating_color %}
                                          <br>({{ order.powder_coating_color }})
                                      {% endif %}
                                  </td>
                                  {% endif %}
                                  <td class="fitting align-middle white-space-nowrap fs-9 text-body">
                                      {{ order.fitting_price|default:"-" }}
                                  </td>
                                  <td class="puffing align-middle white-space-nowrap fs-9 text-body">
                                      {{ order.puffing_price|default:"-" }}
                                  </td>
                                  <td class="mosquito align-middle white-space-nowrap fs-9 text-body">
                                      {% if order.mosquito_net_needed %}
                                          Yes ({{ order.has_mosquito_net|default:"-" }})
                                      {% else %}
                                          No
                                      {% endif %}
                                  </td>
                                  <td class="price align-middle fw-bold text-body-highlight text-end">
                                      ₹{{ order.approximate_amount|default:"-" }}
                                  </td>
                                  <td class="align-middle text-end white-space-nowrap pe-0">
                                  <td class="align-middle text-end white-space-nowrap pe-0">
                                      <div class="btn-group" role="group">
                                          <button class="btn btn-sm btn-primary edit-config-btn" 
                                                  data-bs-toggle="modal" 
                                                  data-bs-target="#editWindowConfigModal"
                                                  data-order-id="{{ order.id }}"
                                                  data-finish="{{ order.finish.id|default:'' }}"
                                                  data-infill="{{ order.infill.id|default:'' }}"
                                                  data-hardware="{{ order.hardware.id|default:'' }}"
                                                  data-lock="{{ order.lock.id|default:'' }}"
                                                  data-other="{{ order.other.id|default:'' }}">
                                              Edit
                                          </button>
                                      </div>
                                  </td>

                              </tr>
                              {% else %}
                              <tr>
                                  <td colspan="{% if customer.powder_coating_type %}11{% else %}10{% endif %}" class="text-center py-4 text-body-tertiary">
                                      No window configuration found
                                  </td>
                              </tr>
                              {% endif %}
                            {% endfor %}  
                          </tbody>
                      </table>
                      </div>
                      <div class="row align-items-center justify-content-between py-2 pe-0 fs-9">
                          <div class="col-auto d-flex">
                              <p class="mb-0 d-none d-sm-block me-3 fw-semibold text-body" data-list-info="data-list-info"></p>
                          </div>
                          <div class="col-auto d-flex">
                              <button class="page-link" data-list-pagination="prev"><span class="fas fa-chevron-left"></span></button>
                              <ul class="mb-0 pagination"></ul>
                              <button class="page-link pe-0" data-list-pagination="next"><span class="fas fa-chevron-right"></span></button>
                          </div>
                      </div>
                  </div>
              </div>

                    <div class="d-flex gap-2 mt-4">
                        {% if not is_approved_for_production and not is_in_production %}
                            <!-- Show Approve Supervisor button if not yet approved -->
                            <a href="#" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#approvedSupervisorModal">
                                <i class="fas fa-industry me-2"></i> Approve for Production
                            </a>
                        {% elif is_approved_for_production and not is_in_production %}
                            <!-- Show Production Status button if approved but not in production -->
                            <a href="#" class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#productionStatusModal">
                                <i class="fas fa-cogs me-2"></i> Update Production Status
                            </a>
                        {% elif is_in_production %}
                            <!-- Navigate to production status page (remove modal target) -->
                            <a href="{% url 'dashboard:production-status-page' customer.id %}" class="btn btn-sm btn-info">
                                <i class="fas fa-tasks me-2"></i> View Production Progress
                            </a>
                        {% endif %}

                        <button class="btn btn-sm btn-success create-config-btn">
                            <i class="fas fa-download me-2"></i> Create customer quotation PDF
                        </button> 
                    </div>

                {{ orders_json|json_script:"orders-data" }}



                <!-- Add this CSS for the quotation table -->
<style>
.quotation-table-container {
    display: none;
    margin-top: 20px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    background: white;
}

.quotation-header {
    background: white;
    padding: 20px;
    border-bottom: 2px solid #e0e0e0;
}

.company-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
}

.company-info {
    text-align: left;
}

.company-logo {
    font-size: 24px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
}

.company-tagline {
    font-size: 14px;
    color: #7f8c8d;
    margin-bottom: 10px;
}

.company-address {
    font-size: 12px;
    color: #34495e;
    line-height: 1.4;
}

.quotation-meta {
    text-align: right;
}

.quotation-number {
    font-size: 14px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
}

.quotation-date {
    font-size: 12px;
    color: #7f8c8d;
}

.customer-info {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
}

.customer-to {
    font-size: 14px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 10px;
}

.customer-details {
    font-size: 12px;
    color: #34495e;
    line-height: 1.6;
}

.quotation-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

.quotation-table th {
    background-color: #2c3e50;
    color: white;
    padding: 12px 8px;
    text-align: center;
    border: 1px solid #34495e;
    font-weight: 600;
}

.quotation-table td {
    padding: 10px 8px;
    border: 1px solid #dee2e6;
    vertical-align: top;
    text-align: center;
}

.quotation-table tr:nth-child(even) {
    background-color: #f8f9fa;
}

.sl-no-column {
    width: 5%;
}

.dwg-column {
    width: 8%;
}

.area-ref-column {
    width: 10%;
}

.description-column {
    width: 25%;
    text-align: left;
}

.rate-column {
    width: 12%;
}

.fitting-column {
    width: 10%;
}

.qty-column {
    width: 8%;
}

.amount-column {
    width: 12%;
}

.terms-conditions {
    margin-top: 20px;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 5px;
    font-size: 12px;
}

.bank-details {
    margin-top: 15px;
    padding: 20px;
    background-color: #e9ecef;
    border-radius: 5px;
    font-size: 12px;
}

.actions-bar {
    margin-top: 15px;
    padding: 15px;
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
    text-align: right;
}

.btn-download-pdf {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.btn-download-pdf:hover {
    background-color: #218838;
}
</style>

<!-- Add this HTML for the quotation table -->
<div class="quotation-table-container" id="quotationTable">
    <div class="quotation-header">
        <div class="company-header">
            <div class="company-info">
                <div class="company-logo">Zipfit</div>
                <div class="company-tagline">KERALA WINDOWS FUTURE FIT</div>
                <div class="company-address">
                    6/125C, KSIDC, INDUSTRIAL GROWTH CENTRE,<br>
                    CHERTHALA, PALIPPURAM<br>
                    +91 9142071400 +9745 651 415<br>
                    sales@zipfit.in | www.zipfit.in
                </div>
            </div>
            <div class="quotation-meta">
                <div class="quotation-number">No.MPAAI/95/2025-26</div>
                <div class="quotation-date">22/08/2025</div>
            </div>
        </div>
        
        <div class="customer-info">
            <div class="customer-to">TO,</div>
            <div class="customer-details">
                <strong>{{ customer.customer_name }}</strong><br>
                {{ customer.customer_address|linebreaksbr }}<br>
                PH NO : {{ customer.customer_phone }}
            </div>
        </div>
    </div>
    
    <div class="table-responsive">
        <table class="quotation-table">
            <thead>
                <tr>
                    <th class="sl-no-column">SL NO</th>
                    <th class="dwg-column">DWG</th>
                    <th class="area-ref-column">AREA/REF</th>
                    <th class="description-column">DESCRIPTION</th>
                    <th class="rate-column">RATE</th>
                    <th class="fitting-column">FITTING</th>
                    <th class="qty-column">QTY</th>
                    <th class="amount-column">AMOUNT</th>
                </tr>
            </thead>
            <tbody>
                <!-- This will be populated with JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="6" style="text-align: right; border: none; padding-top: 15px;"><strong>Sub Total</strong></td>
                    <td colspan="2" style="text-align: center; border: none; padding-top: 15px;"><strong id="subTotalAmount">₹0.00</strong></td>
                </tr>
                <tr>
                    <td colspan="6" style="text-align: right; border: none;"><strong>Grand Total</strong></td>
                    <td colspan="2" style="text-align: center; border: none;"><strong id="grandTotalAmount">₹0.00</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>
    
    <div class="terms-conditions">
        <h5>Terms & Conditions</h5>
        <ol>
            <li>The Quotation Consider ZIPFIT Profile Interpon 9003 SGL White/Wood Lamination Colour Powder Coating.</li>
            <li>Delivery Will Start within 4 to 6 Weeks from date of receiving order</li>
            <li>Windows Security Tape Should be Remove while installing Windows Freely.After Handovering the windows the Security Tape is Removal is not our Scope</li>
            <li>Payment Terms :60% Against Order Confirmation and 30% Before Delivery 10% After Installation The Price are based on the sizes provided by the Customer.The Prices are valid for Variation in Size upto+/50mm per window Provided the design and style of product remains unchanged.The customer will be charged on the pro rate basis for difference between the actual size and given sizes,if any beyond the above</li>
            <li>After handovering the Windows,Cleaning is not our Scope</li>
            <li>Scaffolding : Scaffolding Required for safe erection shall be provided by the customer</li>
            <li>Electricity: Electricity Required for errection shall be provided by the customer</li>
            <li>Store Room : Store romm shall be proved for the errection team keeping all the errection material</li>
            <li>Purchase Order : Purchase Order With Advance To be Placed On us</li>
            <li>Validity of the Offer : -30 Days From the date of Issue</li>
            <li>Trade Union Problem Settled by the 1st Party</li>
            <li>5 Year Warranty for Profile with Colour</li>
            <li>Transporting Charges Extra</li>
            <li>Silicon Application : 5mm of silicone shall only be applied by the Company and any extra gap shall Bourne by the Customer</li>
        </ol>
    </div>
    
    <div class="bank-details">
        <h5>BANK DETAILS</h5>
        <p><strong>NAME:</strong> TRIO ALUMINIUM TRADERS</p>
        <p><strong>ACC NO.:</strong> 076808300000008</p>
        <p><strong>BANK:</strong> SOUTH INDIAN BANK</p>
        <p><strong>BRANCH:</strong> THURAVOOR</p>
        <p><strong>IFSC:</strong> SIBL0000768</p>
    </div>
    
    <div class="actions-bar">
        <button class="btn-download-pdf" onclick="downloadQuotationPDF()">
            <i class="fas fa-download me-2"></i> Download Quotation PDF
        </button>
    </div>
</div>

<!-- Update the button to toggle the quotation table -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const createPdfBtn = document.querySelector('.create-config-btn');
    const quotationTable = document.getElementById('quotationTable');
    
    createPdfBtn.addEventListener('click', function() {
        // Toggle the display of the quotation table
        if (quotationTable.style.display === 'none' || quotationTable.style.display === '') {
            quotationTable.style.display = 'block';
            
            // Populate the table with customer data
            populateQuotationTable();
        } else {
            quotationTable.style.display = 'none';
        }
    });
    
    function populateQuotationTable() {
        // Get the orders data from the JSON script
        const ordersDataElement = document.getElementById('orders-data');
        if (!ordersDataElement) return;
        
        const ordersData = JSON.parse(ordersDataElement.textContent);
        const tableBody = quotationTable.querySelector('tbody');
        tableBody.innerHTML = '';
        
        // Add each order as a row in the table
        ordersData.forEach((order, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>-</td>
                <td>${order.items[0].area || '-'}</td>
                <td style="text-align: left;">
                    <strong>${order.items[0].item || 'Window'}</strong><br>
                    <small>
                        ${order.items[0].profile ? 'Profile: ' + order.items[0].profile : ''}<br>
                        ${order.items[0].finish ? 'Finish: ' + order.items[0].finish : ''}<br>
                        ${order.items[0].infill ? 'Infill: ' + order.items[0].infill : ''}<br>
                        ${order.items[0].hardware ? 'Hardware: ' + order.items[0].hardware : ''}<br>
                        ${order.items[0].lock ? 'Lock: ' + order.items[0].lock : ''}<br>
                        ${order.items[0].other ? 'Other: ' + order.items[0].other : ''}
                    </small>
                </td>
                <td>₹${order.approximate_amount || '0.00'}</td>
                <td>-</td>
                <td>1</td>
                <td>₹${order.approximate_amount || '0.00'}</td>
            `;
            tableBody.appendChild(row);
        });
        
        // Update totals
        updateTotals(ordersData);
    }
    
    function updateTotals(orders) {
        let subtotal = 0;
        orders.forEach(order => {
            if (order.approximate_amount) {
                subtotal += parseFloat(order.approximate_amount);
            }
        });
        
        document.getElementById('subTotalAmount').textContent = '₹' + subtotal.toFixed(2);
        document.getElementById('grandTotalAmount').textContent = '₹' + subtotal.toFixed(2);
    }
    
    function downloadQuotationPDF() {
        // This function would handle the PDF generation
        // For now, we'll just show an alert
        alert('PDF download functionality would be implemented here');
        // In a real implementation, you would:
        // 1. Send the quotation data to your backend
        // 2. Generate a PDF using a library like WeasyPrint, ReportLab, etc.
        // 3. Return the PDF for download
    }
});
</script>
            </div>
          </div>
        </div>
        <footer class="footer position-absolute">
          <div class="row g-0 justify-content-between align-items-center h-100">
            <div class="col-12 col-sm-auto text-center">
              <p class="mb-0 mt-2 mt-sm-0 text-body">Thank you for creating with CipherPeak<span class="d-none d-sm-inline-block"></span><span class="d-none d-sm-inline-block mx-1">|</span><br class="d-sm-none" />2025 &copy;</p>
            </div>
 
          </div>
        </footer>
      </div>
    </main>


<div class="modal fade" id="editWindowConfigModal" tabindex="-1" aria-labelledby="editWindowConfigModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editWindowConfigModalLabel">Edit Window Configuration</h5>
                <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                    <span class="fas fa-times fs-9"></span>
                </button>
            </div>
            <form id="editWindowConfigForm" method="post" action="{% url 'dashboard:update_order_config' %}">
                {% csrf_token %}
                <input type="hidden" name="customer_id" id="editCustomerId" value="{{ customer.id }}">
                <input type="hidden" name="order_id" id="editOrderId">

                <div class="modal-body">
                    <!-- Message area for displaying success/error messages -->
                    <div id="configUpdateMessage" class="alert d-none"></div>
                    
                    <h6 class="mb-3">ADDITIONAL DETAILS</h6>
                    
                    <div class="row g-3">
                        <!-- FINISH Field -->
                        <div class="col-md-4">
                            <label class="form-label" for="finish">Finish</label>
                            <select class="form-select" id="finish" name="finish">
                                <option value="">Select Finish</option>
                                {% for finish in finish_options %}
                                    <option value="{{ finish.id }}">
                                        {{ finish.text }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- INFILL Field -->
                        <div class="col-md-4">
                            <label class="form-label" for="infill">Infill</label>
                            <select class="form-select" id="infill" name="infill">
                                <option value="">Select Infill</option>
                                {% for infill in infill_options %}
                                    <option value="{{ infill.id }}">
                                        {{ infill.text }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- HARDWARE Field -->
                        <div class="col-md-4">
                            <label class="form-label" for="hardware">Hardware</label>
                            <select class="form-select" id="hardware" name="hardware">
                                <option value="">Select Hardware</option>
                                {% for hardware in hardware_options %}
                                    <option value="{{ hardware.id }}">
                                        {{ hardware.text }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- LOCK Field -->
                        <div class="col-md-4">
                            <label class="form-label" for="lock">Lock</label>
                            <select class="form-select" id="lock" name="lock">
                                <option value="">Select Lock</option>
                                {% for lock in lock_options %}
                                    <option value="{{ lock.id }}">
                                        {{ lock.text }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- OTHER Field -->
                        <div class="col-md-4">
                            <label class="form-label" for="other">Other</label>
                            <select class="form-select" id="other" name="other">
                                <option value="">Select Other Option</option>
                                {% for other in other_options %}
                                    <option value="{{ other.id }}">
                                        {{ other.text }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit">Save changes</button>
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="approvedSupervisorModal" tabindex="-1" aria-labelledby="approvedSupervisorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="approvedSupervisorModalLabel">Approve Window Configurations</h5>
                <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                    <span class="fas fa-times fs-9"></span>
                </button>
            </div>
            <form id="approvedSupervisorForm" method="post" action="{% url 'dashboard:approve_supervisor_order' %}">
                {% csrf_token %}
                <input type="hidden" name="customer_id" value="{{ customer.id }}">
                
                <div class="modal-body">
                    <!-- Message area for displaying success/error messages -->
                    <div id="approvalMessage" class="alert d-none"></div>
                    
                    <h6 class="mb-3">WINDOW CONFIGURATIONS</h6>
                    
                    <!-- Orders will be dynamically added here -->
                    <div id="orderConfigurations">
                        {% for order in customer_orders %}
                            <div class="card mb-3 order-configuration" data-order-id="{{ order.id }}">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Order #{{ forloop.counter }}</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <!-- Window Type -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="window_type_{{ order.id }}">Window Type</label>
                                            <select class="form-select window-type-select" id="window_type_{{ order.id }}" name="window_type_{{ order.id }}">
                                                <option value="">Select Window Type</option>
                                                {% for window_type in window_types %}
                                                    <option value="{{ window_type.id }}" {% if order.window_model and order.window_model.window_type.id == window_type.id %}selected{% endif %}>
                                                        {{ window_type.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        
                                        <!-- Window Series -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="window_series_{{ order.id }}">Window Series</label>
                                            <select class="form-select window-series-select" id="window_series_{{ order.id }}" name="window_series_{{ order.id }}">
                                                <option value="">Select Window Series</option>
                                                {% for series in window_series %}
                                                    <option value="{{ series.id }}" {% if order.window_model and order.window_model.window_series.id == series.id %}selected{% endif %}>
                                                        {{ series.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        
                                        <!-- Window Model -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="window_model_{{ order.id }}">Window Model</label>
                                            <select class="form-select window-model-select" id="window_model_{{ order.id }}" name="window_model_{{ order.id }}">
                                                <option value="">Select Window Model</option>
                                                {% for config in window_configurations %}
                                                    <option value="{{ config.id }}" {% if order.window_model and order.window_model.id == config.id %}selected{% endif %} data-width="{{ config.width.value }}" data-height="{{ config.height.value }}">
                                                        {{ config.window_type.name }} - {{ config.window_series.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        
                                        <!-- Actual Width -->
                                        <div class="col-md-6">
                                            <label class="form-label" for="actual_width_{{ order.id }}">Actual Width (mm)</label>
                                            <input type="number" class="form-control actual-width" id="actual_width_{{ order.id }}" name="actual_width_{{ order.id }}" 
                                                  step="0.01" min="0" placeholder="Enter actual width" value="{% if order.window_model and order.window_model.width %}{{ order.window_model.width.value }}{% endif %}">
                                            <small class="text-muted">Original: {% if order.window_model and order.window_model.width %}{{ order.window_model.width.name }}{% else %}Not specified{% endif %} mm</small>
                                        </div>
                                        
                                        <!-- Actual Height -->
                                        <div class="col-md-6">
                                            <label class="form-label" for="actual_height_{{ order.id }}">Actual Height (mm)</label>
                                            <input type="number" class="form-control actual-height" id="actual_height_{{ order.id }}" name="actual_height_{{ order.id }}" 
                                                  step="0.01" min="0" placeholder="Enter actual height" value="{% if order.window_model and order.window_model.height %}{{ order.window_model.height.value }}{% endif %}">
                                            <small class="text-muted">Original: {% if order.window_model and order.window_model.height %}{{ order.window_model.height.name }}{% else %}Not specified{% endif %} mm</small>
                                        </div>
                                        
                                        <!-- Surface Treatment -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="surface_treatment_{{ order.id }}">Surface Treatment</label>
                                            <input type="text" class="form-control" id="surface_treatment_{{ order.id }}" name="surface_treatment_{{ order.id }}" 
                                                  value="{% if order.surface_treatment %}{{ order.surface_treatment.name }}{% endif %}" readonly>
                                        </div>
                                        
                                        <!-- Wood Lamination Types -->
                                        <div class="col-md-4">
                                            <label class="form-label">Wood Lamination Types</label>
                                            <div>
                                                {% for wood in order.wood_lamination_types.all %}
                                                    <span class="badge bg-secondary">{{ wood.name }}</span>
                                                {% empty %}
                                                    <span class="text-muted">None</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        
                                        <!-- Powder Coating Type -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="powder_coating_type_{{ order.id }}">Powder Coating Type</label>
                                            <input type="text" class="form-control" id="powder_coating_type_{{ order.id }}" name="powder_coating_type_{{ order.id }}" 
                                                  value="{% if order.powder_coating_type %}{{ order.powder_coating_type.name }}{% endif %}" readonly>
                                        </div>
                                        
                                        <!-- Powder Coating Color -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="powder_coating_color_{{ order.id }}">Powder Coating Color</label>
                                            <input type="text" class="form-control" id="powder_coating_color_{{ order.id }}" name="powder_coating_color_{{ order.id }}" 
                                                  value="{% if order.powder_coating_color %}{{ order.powder_coating_color.name }}{% endif %}" readonly>
                                        </div>
                                        
                                        <!-- Mosquito Net -->
                                        <div class="col-md-4">
                                            <label class="form-label">Mosquito Net</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="mosquito_net_{{ order.id }}" name="mosquito_net_{{ order.id }}" 
                                                      {% if order.mosquito_net_needed %}checked{% endif %} disabled>
                                                <label class="form-check-label" for="mosquito_net_{{ order.id }}">
                                                    Needed
                                                </label>
                                            </div>
                                            <div>
                                                <small>Type: {% if order.has_mosquito_net %}{{ order.has_mosquito_net.name }}{% else %}Not specified{% endif %}</small>
                                            </div>
                                        </div>
                                        
                                        <!-- Fitting Price -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="fitting_price_{{ order.id }}">Fitting Price</label>
                                            <input type="text" class="form-control" id="fitting_price_{{ order.id }}" name="fitting_price_{{ order.id }}" 
                                                  value="{% if order.fitting_price %}{{ order.fitting_price.price }}{% endif %}" readonly>
                                        </div>
                                        
                                        <!-- Puffing Price -->
                                        <div class="col-md-4">
                                            <label class="form-label" for="puffing_price_{{ order.id }}">Puffing Price</label>
                                            <input type="text" class="form-control" id="puffing_price_{{ order.id }}" name="puffing_price_{{ order.id }}" 
                                                  value="{% if order.puffing_price %}{{ order.puffing_price.price }}{% endif %}" readonly>
                                        </div>

                                        
                                        <!-- Approximate Amount -->
                                        <div class="col-md-6">
                                            <label class="form-label" for="approximate_amount_{{ order.id }}">Approximate Amount</label>
                                            <input type="text" class="form-control" id="approximate_amount_{{ order.id }}" name="approximate_amount_{{ order.id }}" 
                                                  value="{% if order.approximate_amount %}{{ order.approximate_amount }}{% endif %}" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Customer Details -->
                    <h6 class="mb-3 mt-5">CUSTOMER DETAILS</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Customer Name</label>
                            <p class="form-control-plaintext fw-bold">{{ customer.customer_name }}</p>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Customer Email</label>
                            <p class="form-control-plaintext fw-bold">{{ customer.customer_email }}</p>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Customer Phone</label>
                            <p class="form-control-plaintext fw-bold">{{ customer.customer_phone }}</p>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Customer Address</label>
                            <p class="form-control-plaintext fw-bold">{{ customer.customer_address }}</p>
                        </div>
                    </div>
                    
                    <!-- Approval Checkbox -->
                    <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" id="supervisor_approval" name="supervisor_approval">
                        <label class="form-check-label fw-bold" for="supervisor_approval">
                            I approve this order for production
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit">Save Approval</button>
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle edit button click
        const editButtons = document.querySelectorAll('.edit-config-btn');
        const editOrderIdField = document.getElementById('editOrderId');
        const messageDiv = document.getElementById('configUpdateMessage');
        
        editButtons.forEach(button => {
            button.addEventListener('click', function() {
                const orderId = this.getAttribute('data-order-id');
                const finishId = this.getAttribute('data-finish');
                const infillId = this.getAttribute('data-infill');
                const hardwareId = this.getAttribute('data-hardware');
                const lockId = this.getAttribute('data-lock');
                const otherId = this.getAttribute('data-other');
                
                // Set the order ID
                editOrderIdField.value = orderId;
                
                // Pre-populate form fields
                if (finishId) {
                    document.getElementById('finish').value = finishId;
                } else {
                    document.getElementById('finish').value = '';
                }
                
                if (infillId) {
                    document.getElementById('infill').value = infillId;
                } else {
                    document.getElementById('infill').value = '';
                }
                
                if (hardwareId) {
                    document.getElementById('hardware').value = hardwareId;
                } else {
                    document.getElementById('hardware').value = '';
                }
                
                if (lockId) {
                    document.getElementById('lock').value = lockId;
                } else {
                    document.getElementById('lock').value = '';
                }
                
                if (otherId) {
                    document.getElementById('other').value = otherId;
                } else {
                    document.getElementById('other').value = '';
                }
                
                // Hide any previous messages
                messageDiv.classList.add('d-none');
            });
        });
        
        // Handle form submission with AJAX
        document.getElementById('editWindowConfigForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = this;
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = data.message;
                    messageDiv.classList.remove('d-none');
                    
                    // Close modal and refresh page after a short delay
                    setTimeout(function() {
                        $('#editWindowConfigModal').modal('hide');
                        location.reload(); // Refresh the page
                    }, 1500);
                } else {
                    // Show error message
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = data.message;
                    messageDiv.classList.remove('d-none');
                }
            })
            .catch(error => {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = 'An error occurred while updating the configuration.';
                messageDiv.classList.remove('d-none');
                console.error('Error:', error);
            });
        });
        
        // Reset form when modal is hidden
        $('#editWindowConfigModal').on('hidden.bs.modal', function () {
            document.getElementById('editWindowConfigForm').reset();
            messageDiv.classList.add('d-none');
        });
    });
    </script>

  <style>
  .btn-group .btn {
      margin-right: 5px;
  }
  .btn-group .btn:last-child {
      margin-right: 0;
  }
  </style> 
    
{% endblock %}


